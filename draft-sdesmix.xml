<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc compact="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="5"?>
<?rfc rfcedstyle="yes"?>
<?rfc subcompact="no"?>
<rfc ipr="trust200902" number="draft-sdesmix" category="info"
  submissionType="IETF" consensus="yes">
<front>
<title abbrev="SDES Mix">Key Mixing Extension for SDES</title>

<author initials="P." surname="Zimmermann" fullname="Philip Zimmermann">
<organization>Silent Circle, LLC</organization>
<address>
<postal>
<street></street>
<city>Santa Cruz</city><region>California</region>
</postal>
<email>prz@mit.edu</email>
<uri>http://philzimmermann.com</uri>
</address>
</author>

<author initials="T." surname="Cross" fullname="Travis Cross">
<organization>OfficeTone, LLC</organization>
<address>
<email>tc@traviscross.com</email>
<uri>http://traviscross.com</uri>
</address>
</author>

<author initials="D." surname="Wing" fullname="Dan Wing">
<organization>Cisco Systems, Inc.</organization>
<address>
<email>dwing@cisco.com</email>
</address>
</author>

<date month="November" year="2012"/>

<abstract>
<t>
This document defines a method by which endpoints using SDES can prevent attackers from using SIP forking to capture useful key material.  We define a Session Description Protocol (SDP) attribute for unicast media streams which can be used to negotiate this extension to SDES (RFC 4568). </t>
</abstract>

</front>

<middle>
<section anchor='enhanced_sdes' title="Enhanced SDES for SIP forking">
<t>
There is a vulnerability when <xref target="RFC4568">SDES</xref> is used with SIP forking.  In SIP forking, the SIP initiator sends separate SIP Invites to multiple SIP endpoints, each containing the same SDES key from the SIP initiator.  If an adversary is in possession of a target's SIP password and registers to become one of the SIP endpoints to receive the SIP Invite, the adversary will have the SDES key to decrypt the media stream from the SIP initiator, even if a different device responds to the SIP Invite.  Here we propose a method to mitigate this vulnerability. </t>
<t>
There are two separate SRTP master keys and salts provided by SDES, one for each direction of media flow.  In SIP forking, only one SIP responder will answer the call with a SIP 200 OK, returning a different SDES key for SRTP media from the SIP responder.  The attacker does not have access to the SDES key from the 200 OK. </t>
<t>
To prevent the adversary from exploiting the SDES key captured from the SIP Invite, both parties may hash together both SDES parameters from both parties, and then use the combined hash result to re-derive new keys and salts to replace the original SDES material for both endpoints. </t>
<t>
We use the extract-and-expand construct defined in <xref target="RFC5869"/>. </t>

<figure><artwork>
  salt = srtpmsi || srtpmsr
  ikm = len(srtpmki) || srtpmki || len(srtpmkr) || srtpmkr
  prk = MAC(salt, ikm)

  srtpmsi2 = MAC(prk, 0x01)
  srtpmki2 = MAC(prk, srtpmsi2 || 0x02)
  srtpmsr2 = MAC(prk, srtpmki2 || 0x03)
  srtpmkr2 = MAC(prk, srtpmsr2 || 0x04)

</artwork></figure>
<t>
In the above formula, the MAC function is defined as HMAC-SHA-384.  The output of the MAC will be truncated as described below.  The parameters srtpmki and srtpmsi are extracted from the SDES transmitted by the SIP initiator, while srtpmkr and srtpmsr are extracted from the SDES transmitted by the SIP responder.  These keys and salts are in binary form, not the base64 representation used by SDES.  The numeric constants are represented by a single octet.  The explicit length fields, len(), in the above functions are 32-bit big-endian integers, giving the length in octets of the field that follows.  The length in octets of srtpmki or srtpmkr can only be 16, 24, or 32, if the AES is used.  srtpmki is the SIP initiator's SRTP master key, srtpmkr is the SIP responder's SRTP master key, srtpmsi is the SIP initiator's SRTP master salt, and srtpmsr is the SIP responder's SRTP master salt.  The length of the SRTP master salts are defined as 112 bits (14 octets) in <xref target="RFC3711"/>.  The old values for srtpmki, srtpmkr, srtpmsi, srtpmsr, are all respectively replaced by the new values srtpmki2, srtpmkr2, srtpmsi2, and srtpmsr2.  The MAC output is truncated to 14 octets for srtpmsi2 and srtpmsr2, and to the corresponding original key lengths for srtpmki2 and srtpmkr2. </t>
<t>
The original crypto suite selected by SDES remains unchanged, including the block cipher algorithm, the key lengths, and the SRTP auth tag sizes and auth tag algorithms.  All keys should be erased immediately after use. </t>
<t>
Before applying the above enhancements, the two SIP user agents discover if they both support this extension to SDES by detecting the optional a=sdesmix SDP attribute from both endpoints. </t>

</section>

</middle>

<back>
<?rfc rfcedstyle="no" ?>
<references title="Normative References">
<!--<rfc include="reference.RFC.2104" />--><!-- HMAC -->
<!--<rfc include="reference.RFC.2119" />--><!-- RFC Keywords -->
<?rfc include="reference.RFC.3711" ?><!-- SRTP -->
<!--<rfc include="reference.RFC.4566" />--><!-- SDP -->
<?rfc include="reference.RFC.4568" ?><!-- SDES -->
<?rfc include="reference.RFC.5869" ?><!-- HKDF -->
</references>

<!--<references title="Informative References">-->
<!--<rfc include="reference.RFC.3261" />--><!-- SIP -->
<!--<rfc include="reference.RFC.4086" />--><!-- Randomness Requirements for Security -->
<!--<rfc include="reference.RFC.4474" />--><!-- SIP Authenticated Identity -->
<!--<rfc include="reference.RFC.4960" />--><!-- SCTP -->
<!--<rfc include="reference.RFC.5246" />--><!-- TLS 1.2 -->
<!--<rfc include="reference.RFC.5479" />--><!-- Media Security Requirements -->
<!--<rfc include="reference.RFC.5764" />--><!-- DTLS -->
<!--<rfc include="reference.RFC.6188" />--><!-- SRTP AES-192 AES-256 -->
<!--</references>-->

<?rfc rfcedstyle="yes" ?>
<?rfc symrefs="yes" ?>
</back>
</rfc>
